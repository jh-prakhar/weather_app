<!-- index.html (very minimal) -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Prakhar Jha Weather App</title>
  <style>
    /* Minimal layout. Designer will fix visuals. */
    body { font-family: sans-serif; padding: 20px; }
    .weather { border: 1px solid #ddd; padding: 10px; margin-top: 10px;}
  </style>
</head>
<body>
  <h1>Prakhar Jha Weather</h1>
  <button id="infoBtn">ℹ️ Info</button>
  <div>
    <input id="locInput" placeholder="Enter city, zipcode, coords or landmark" style="width:60%">
    <button id="searchBtn">Search</button>
    <button id="gpsBtn">Use my location</button>
  </div>
  <div id="candidates"></div>
  <div id="result"></div>

  <script>
    const apiBase = "http://localhost:8000";
    document.getElementById("searchBtn").onclick = async () => {
      const q = document.getElementById("locInput").value;
      const res = await fetch(`${apiBase}/geocode`, {
        method:"POST", headers:{"Content-Type":"application/json"},
        body: JSON.stringify({query: q})
      });
      if(!res.ok){ alert("No location found"); return; }
      const data = await res.json();
      const container = document.getElementById("candidates");
      container.innerHTML = "";
      data.candidates.forEach((c, idx) => {
        const btn = document.createElement("button");
        btn.textContent = c.name;
        btn.onclick = () => fetchWeather(c.lat, c.lon, c.name);
        container.appendChild(btn);
      });
    };

    async function fetchWeather(lat, lon, name){
      const res = await fetch(`${apiBase}/weather?lat=${lat}&lon=${lon}`);
      const data = await res.json();
      const r = document.getElementById("result");
      r.innerHTML = `<h3>${name}</h3>
        <div class='weather'>
          <h4>Now: ${data.current.weather[0].description}, ${data.current.main.temp} °C</h4>
          <img src="http://openweathermap.org/img/wn/${data.current.weather[0].icon}@2x.png" />
        </div>
        <div>
          <h4>5-day summary</h4>
          ${data.forecast_daily.map(d => `<div>${d.date}: ${d.temp_min} - ${d.temp_max}°C - ${d.weather_sample.description}</div>`).join('')}
        </div>`;
    }

    document.getElementById("gpsBtn").onclick = () => {
      navigator.geolocation.getCurrentPosition(async pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        // optionally reverse geocode to show name
        fetchWeather(lat, lon, `Your location (${lat.toFixed(2)},${lon.toFixed(2)})`);
      }, err => alert("Geolocation failed: " + err.message));
    };

    document.getElementById("infoBtn").onclick = () => {
      window.open("https://www.linkedin.com/company/product-manager-accelerator", "_blank");
    };
  </script>
</body>
</html>
